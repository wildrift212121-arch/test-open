Aion 2 Route Recorder — Техническое задание  
Версия документа: 4.0
Дата: 15.03.2024
Статус: Рабочая версия

1. История изменений
v4.0 — 15.03.2024
[GUI FIX] Исправлены неработающие кнопки (корректный режим обработки событий)

[GUI FIX] Добавлено управление состоянием кнопок (ENABLE/DISABLE)

[GUI FIX] Улучшен интерфейс, добавлены инструкции

[FIX] Удалены попытки проверки клавиш через DD драйвер

[FIX] Исправлена работа с файлами (UTF‑8)

[FEAT] Добавлен подсчёт событий в лог‑файле

[FEAT] Реализовано обновление статуса записи в реальном времени

[FEAT] Добавлено отображение длительности записи

[DOC] Обновлено README

v3.0 — 15.03.2024
[ARCHITECTURE] Переход на пассивную запись маршрутов

[REALIZATION] Подтверждено ограничение DD драйвера (нет функции чтения клавиш)

[DESIGN] Новый интерфейс с ручным управлением записью

2. Цель проекта
Создать систему записи маршрутов для игры Aion 2, фиксирующую действия игрока (клавиши, мышь) и сохраняющую их в лог‑файл для последующего воспроизведения через DD драйвер.

3. Ограничения
3.1. Ограничения DD драйвера
DD драйвер предоставляет только функции эмуляции:

DD_btn(code) — имитация нажатия

DD_key(code, state) — установка состояния клавиши

DD_mov(x, y) — движение мыши

Не предоставляет:

проверку состояния клавиш

перехват событий

хуки клавиатуры/мыши

3.2. Следствия
Невозможно реализовать активный рекордер (который сам отслеживает нажатия)

Единственный рабочий вариант — пассивная запись, когда:

пользователь вручную нажимает клавиши в игре

скрипт фиксирует только временные метки и DD‑коды

воспроизведение выполняется позже

4. Архитектура системы
4.1. Текущая архитектура (v4.0)
Пассивный рекордер, состоящий из:

GUI‑интерфейса

логгера событий

системы управления состоянием записи

подсчёта событий и длительности

Пользователь вручную управляет записью.

4.2. Поток работы
Code
[Пользователь] → [Игра Aion 2] → [Ручной ввод]
                                   ↓
                           [Скрипт v4.0]
                                   ↓
                           [Лог-файл .log]
5. Текущий статус разработки
5.1. Завершено
Рабочий GUI

Активные кнопки с корректным состоянием

Запись лог‑файлов в формате DD‑кодов

Отображение статуса записи

Подсчёт событий

Подсчёт длительности записи

README с инструкциями

5.2. Реализованные функции
_StartRecording() — запуск записи

_StopRecording() — остановка записи

_UpdateRecordingStatus() — обновление статуса

_CountEventsInLog() — подсчёт событий

Полный цикл GUI‑управления

5.3. Требуется в следующей версии (v5.0)
Плеер для воспроизведения логов

Эмуляция ввода через DD.dll

Тестирование воспроизведения в игре

Добавление записи движений мыши

Добавление защиты от дребезга и ложных событий

Добавление диагностики пропущенных событий

Буферизация лога для высокой скорости

6. Формат лог‑файла
6.1. Структура
Code
[START_TIMESTAMP:UnixTime]
TimeInSeconds:DD_Code:Action
6.2. Пример
Code
[START_TIMESTAMP:1704067200]
0.000:602:DOWN
1.500:602:UP
2.100:801:DOWN
7. Таблица DD‑кодов
Клавиша	DD код
W	602
A	801
S	802
D	803
Q	601
E	603
R	604
F	804
Z	901
X	902
C	903
V	904
1	300
2	301
3	302
4	303
SPACE	1003
LSHIFT	900
LCTRL	1000
8. Инструкция по использованию
Поместите dd60300.dll в папку со скриптом

Запустите скрипт от имени администратора

Запустите игру Aion 2

Нажмите «Старт записи»

Переключитесь в игру и играйте вручную

Нажмите «Стоп записи»

Лог‑файл появится в папке со скриптом

9. Технические детали
9.1. Проблемы v3.0
Кнопки не реагировали

Неверный режим обработки GUI событий

Не было управления состоянием кнопок

Ошибки при работе с файлами

Неверная логика записи

9.2. Решения v4.0
Переход на GUIGetMsg()

Использование $GUI_ENABLE / $GUI_DISABLE

Хранение ID кнопок в глобальных переменных

Корректная инициализация GUI

Добавление UTF‑8

Добавление подсчёта событий

Добавление длительности записи

10. Требования к будущим версиям
10.1. Требования к стабильности
Логирование без потери событий

Защита от дребезга клавиш

Диагностика пропущенных событий

10.2. Требования к производительности
Опрос клавиш ≤ 5–10% CPU

Буферизация логирования

GUI не должен тормозить запись

10.3. Требования к воспроизведению (v5.0)
Точный тайминг (1–3 мс)

Поддержка одновременных клавиш

Поддержка движения мыши

Пауза/продолжение

Ускоренное воспроизведение

10.4. Требования к лог‑файлам
Стабильный формат между версиями

Обратная совместимость

Проверка целостности файла